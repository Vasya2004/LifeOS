// ============================================
// ACHIEVEMENTS MODULE TYPES
// ============================================

export type AchievementType = 'micro' | 'macro' | 'breakthrough' | 'moment'
export type AchievementCategory = 'work' | 'health' | 'personal' | 'skill' | 'finance' | 'relationships' | 'other'
export type EmotionTag = 'proud' | 'relieved' | 'excited' | 'grateful' | 'surprised' | 'scared' | 'joyful'
export type SourceType = 'goal' | 'skill' | 'habit' | 'health' | 'finance' | 'task' | 'manual'

export interface Achievement {
  id: string
  userId: string
  
  // Basic Info
  title: string
  description?: string
  
  // Categorization
  category?: AchievementCategory
  type: AchievementType
  
  // Date & Time
  achievementDate: string // ISO date
  achievementTime?: string // HH:mm
  
  // Emotional & Reflection
  emotionTag?: EmotionTag
  lessonLearned?: string
  
  // Media
  mediaUrls: string[]
  coverImageIndex: number
  
  // Special Flags
  isAutoGenerated: boolean
  isTimeCapsule: boolean
  unlockDate?: string // ISO datetime
  isFavorite: boolean
  
  // Visibility
  isPrivate: boolean
  shareToken?: string
  
  // Gamification
  xpAwarded: number
  badgeIcon: string
  badgeColor: string
  
  // Metadata
  createdAt: string
  updatedAt?: string
  
  // Relations
  links?: AchievementLink[]
  collections?: string[] // collection IDs
}

export interface AchievementLink {
  id: string
  achievementId: string
  userId: string
  sourceType: SourceType
  sourceId?: string
  sourceTitle?: string
  linkDescription?: string
  createdAt: string
}

export interface AchievementCollection {
  id: string
  userId: string
  name: string
  description?: string
  icon: string
  color: string
  isDefault: boolean
  sortOrder: number
  createdAt: string
  updatedAt?: string
  
  // Computed
  achievementCount?: number
}

export interface AchievementCollectionItem {
  id: string
  achievementId: string
  collectionId: string
  userId: string
  addedAt: string
  note?: string
}

export interface AchievementStats {
  id: string
  userId: string
  totalCount: number
  microCount: number
  macroCount: number
  breakthroughCount: number
  momentCount: number
  favoriteCount: number
  timeCapsuleCount: number
  timeCapsuleUnlockedCount: number
  currentStreakDays: number
  longestStreakDays: number
  lastAchievementDate?: string
  updatedAt?: string
}

// ============================================
// UI TYPES
// ============================================

export interface AchievementFilters {
  types?: AchievementType[]
  categories?: AchievementCategory[]
  dateFrom?: string
  dateTo?: string
  isFavorite?: boolean
  isTimeCapsule?: boolean
  searchQuery?: string
  collectionId?: string
}

export interface AchievementSort {
  field: 'date' | 'title' | 'type' | 'created'
  direction: 'asc' | 'desc'
}

// ============================================
// CONSTANTS
// ============================================

export const ACHIEVEMENT_TYPE_CONFIG: Record<AchievementType, {
  label: string
  labelRu: string
  icon: string
  color: string
  description: string
}> = {
  micro: {
    label: 'Micro Win',
    labelRu: '–ú–∏–∫—Ä–æ-–ø–æ–±–µ–¥–∞',
    icon: 'zap',
    color: '#22c55e',
    description: '–ú–∞–ª–µ–Ω—å–∫–∏–µ, –Ω–æ –≤–∞–∂–Ω—ã–µ —à–∞–≥–∏ –≤–ø–µ—Ä–µ–¥'
  },
  macro: {
    label: 'Major Goal',
    labelRu: '–ö—Ä—É–ø–Ω–∞—è —Ü–µ–ª—å',
    icon: 'trophy',
    color: '#3b82f6',
    description: '–ó–Ω–∞—á–∏–º—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏'
  },
  breakthrough: {
    label: 'Breakthrough',
    labelRu: '–ü—Ä–æ—Ä—ã–≤',
    icon: 'star',
    color: '#8b5cf6',
    description: '–ü—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤ –∏ –ª–∏—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π'
  },
  moment: {
    label: 'Magic Moment',
    labelRu: '–ú–∞–≥–∏—á–µ—Å–∫–∏–π –º–æ–º–µ–Ω—Ç',
    icon: 'sparkles',
    color: '#f59e0b',
    description: '–°–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ —Ä–∞–¥–æ—Å—Ç–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã'
  }
}

export const ACHIEVEMENT_CATEGORY_CONFIG: Record<AchievementCategory, {
  label: string
  labelRu: string
  icon: string
  color: string
}> = {
  work: { label: 'Work', labelRu: '–†–∞–±–æ—Ç–∞', icon: 'briefcase', color: '#3b82f6' },
  health: { label: 'Health', labelRu: '–ó–¥–æ—Ä–æ–≤—å–µ', icon: 'heart', color: '#22c55e' },
  personal: { label: 'Personal', labelRu: '–õ–∏—á–Ω–æ–µ', icon: 'user', color: '#ec4899' },
  skill: { label: 'Skill', labelRu: '–ù–∞–≤—ã–∫', icon: 'sparkles', color: '#f59e0b' },
  finance: { label: 'Finance', labelRu: '–§–∏–Ω–∞–Ω—Å—ã', icon: 'wallet', color: '#14b8a6' },
  relationships: { label: 'Relationships', labelRu: '–û—Ç–Ω–æ—à–µ–Ω–∏—è', icon: 'users', color: '#f97316' },
  other: { label: 'Other', labelRu: '–î—Ä—É–≥–æ–µ', icon: 'circle', color: '#6b7280' }
}

export const EMOTION_TAG_CONFIG: Record<EmotionTag, {
  label: string
  labelRu: string
  emoji: string
  color: string
}> = {
  proud: { label: 'Proud', labelRu: '–ì–æ—Ä–¥–æ—Å—Ç—å', emoji: 'ü¶Å', color: '#f59e0b' },
  relieved: { label: 'Relieved', labelRu: '–û–±–ª–µ–≥—á–µ–Ω–∏–µ', emoji: 'üòå', color: '#22c55e' },
  excited: { label: 'Excited', labelRu: '–í–æ—Å—Ç–æ—Ä–≥', emoji: 'ü§©', color: '#ec4899' },
  grateful: { label: 'Grateful', labelRu: '–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å', emoji: 'üôè', color: '#8b5cf6' },
  surprised: { label: 'Surprised', labelRu: '–£–¥–∏–≤–ª–µ–Ω–∏–µ', emoji: 'üò≤', color: '#3b82f6' },
  scared: { label: 'Scared', labelRu: '–°—Ç—Ä–∞—Ö', emoji: 'üò∞', color: '#ef4444' },
  joyful: { label: 'Joyful', labelRu: '–†–∞–¥–æ—Å—Ç—å', emoji: 'üòÑ', color: '#eab308' }
}

// ============================================
// FORM TYPES
// ============================================

export interface CreateAchievementInput {
  title: string
  description?: string
  category?: AchievementCategory
  type: AchievementType
  achievementDate: string
  achievementTime?: string
  emotionTag?: EmotionTag
  lessonLearned?: string
  mediaUrls?: string[]
  isTimeCapsule?: boolean
  unlockDate?: string
  isFavorite?: boolean
  isPrivate?: boolean
  links?: { sourceType: SourceType; sourceId?: string; sourceTitle?: string }[]
  collectionIds?: string[]
}

export interface UpdateAchievementInput extends Partial<CreateAchievementInput> {
  id: string
}

// ============================================
// STATS HELPERS
// ============================================

export function getAchievementTypeColor(type: AchievementType): string {
  return ACHIEVEMENT_TYPE_CONFIG[type].color
}

export function getAchievementTypeLabel(type: AchievementType): string {
  return ACHIEVEMENT_TYPE_CONFIG[type].labelRu
}

export function getAchievementTypeIcon(type: AchievementType): string {
  return ACHIEVEMENT_TYPE_CONFIG[type].icon
}

export function getCategoryLabel(category: AchievementCategory): string {
  return ACHIEVEMENT_CATEGORY_CONFIG[category].labelRu
}

export function getEmotionLabel(emotion: EmotionTag): string {
  return EMOTION_TAG_CONFIG[emotion].labelRu
}

export function getEmotionEmoji(emotion: EmotionTag): string {
  return EMOTION_TAG_CONFIG[emotion].emoji
}
